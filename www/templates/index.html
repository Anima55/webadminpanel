<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    </head>
<body data-user-rank="{{ user_rank }}">

    <header class="top-nav">
        <div class="nav-left">
            <div class="nav-icon"><a href="/" style="color:white; text-decoration:none;">üõ°Ô∏è ForgeRock</a></div> 
            {% if user_rank == 'SuperAdmin' %}
            <a href="/admin-page" class="nav-button" style="background-color: #007bff; margin-left: 10px;">üõ†Ô∏è –ê–¥–º—ñ–Ω-–ü–∞–Ω–µ–ª—å</a>
            {% endif %}
        </div>

        <nav class="nav-right">
            <a href="{{ url_for('home') }}" class="nav-button">HelperInfo</a>
            <a href="{{ url_for('tickets') }}" class="nav-button">TicketInfo</a>
            <a href="{{ url_for('logout') }}" class="nav-button" style="background-color: #dc3545;">–í–∏—Ö—ñ–¥</a>
            
        </nav>
    </header>
    <main class="site-body">
        
        <section class="main-block">
            <script src="{{ url_for('script', filename='filter.js') }}"></script>
            <script src="{{ url_for('script', filename='excel.js') }}"></script>

            <div class="search-bar-container">
    <div class="search-filter-wrapper">
        <div class="search-input-wrapper">
            <form action="{{ url_for('home') }}" method="GET" class="search-form" id="filterForm">
                <input type="text" id="searchQuery" name="query"
                placeholder="–ü–æ—à—É–∫ –∑–∞ —ñ–º'—è–º" 
               value="{{ request.args.get('query', '') }}" class="search-input">
                <input type="hidden" name="sort_by" id="active_sort_by" value="{{ sort_by }}">
                <input type="hidden" name="sort_type" id="active_sort_type" value="{{ sort_type }}">
                <input type="hidden" name="rank_filter" id="active_rank_filter" value="{{ rank_filter }}">
            </form>
        </div>
        <button type="button" class="filter-btn" onclick="openFilterModal()">‚öôÔ∏è –§—ñ–ª—å—Ç—Ä</button>
        <button type="button" class="export-btn" onclick="exportHelperInfoToExcel()">üìä –ï–∫—Å–ø–æ—Ä—Ç –≤ Excel</button> 
    </div>
</div>
            <div id="filterModal" class="modal">
    <div class="modal-content filter-modal-content">
        <span class="close-btn" onclick="closeFilterModal()">&times;</span>
        <h2>–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ñ—ñ–ª—å—Ç—Ä—ñ–≤</h2>
        
        <form method="GET" action="{{ url_for('home') }}" id="filterForm">
            
            <input type="hidden" name="query" value="{{ request.args.get('query', '') }}">
            <input type="hidden" name="sort_by" id="active_sort_by" value="{{ request.args.get('sort_by', '') }}">
            <input type="hidden" name="sort_type" id="active_sort_type" value="{{ request.args.get('sort_type', 'asc') }}">
            <input type="hidden" name="rank_filter" id="active_rank_filter" value="{{ request.args.get('rank_filter', '') }}">

            <h3>–°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è:</h3>

            {% set current_sort_by = request.args.get('sort_by', '') %}
            {% set current_sort_type = request.args.get('sort_type', 'asc') %}

            <div class="filter-option">
    <label>–Ü–º'—è (–∑–∞ –∞–ª—Ñ–∞–≤—ñ—Ç–æ–º):</label>
    <div class="sort-control">
        <button type="button" class="sort-toggle-btn" id="admin_name_btn"
                data-sort-field="admin_name" onclick="applySort('admin_name', 'admin_name_btn')">
            {% if current_sort_by == 'admin_name' %}
                {{ '‚¨áÔ∏è –°–ø–∞–¥–∞–Ω–Ω—è' if current_sort_type == 'desc' else '‚¨ÜÔ∏è –ó—Ä–æ—Å—Ç–∞–Ω–Ω—è' }}
            {% else %}
                üîÑ –°–æ—Ä—Ç—É–≤–∞—Ç–∏
            {% endif %}
        </button>
    </div>
</div>

<div class="filter-option">
    <label>–ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è:</label>
    <div class="sort-control">
        <button type="button" class="sort-toggle-btn" id="warnings_count_btn"
                data-sort-field="warnings_count" onclick="applySort('warnings_count', 'warnings_count_btn')">
            {% if current_sort_by == 'warnings_count' %}
                {{ '‚¨áÔ∏è –°–ø–∞–¥–∞–Ω–Ω—è' if current_sort_type == 'desc' else '‚¨ÜÔ∏è –ó—Ä–æ—Å—Ç–∞–Ω–Ω—è' }}
            {% else %}
                üîÑ –°–æ—Ä—Ç—É–≤–∞—Ç–∏
            {% endif %}
        </button>
    </div>
</div>

            <h3 style="margin-top: 20px;">–§—ñ–ª—å—Ç—Ä –∑–∞ —Ä–∞–Ω–≥–æ–º:</h3>
            
            {% set current_rank_filter = request.args.get('rank_filter', '') %}
            
            <div class="rank-filter-section">
                <label for="rank_filter_select">–û–±–µ—Ä—ñ—Ç—å —Ä–∞–Ω–≥:</label>
                <select id="rank_filter_select" class="rank-select">
                    <option value="">–í—Å—ñ —Ä–∞–Ω–≥–∏</option>
                    <option value="Moder" {% if current_rank_filter == 'Moder' %}selected{% endif %}>Moder</option>
                    <option value="Admin" {% if current_rank_filter == 'Admin' %}selected{% endif %}>Admin</option>
                    <option value="Curator" {% if current_rank_filter == 'Curator' %}selected{% endif %}>Curator</option>
                    <option value="Manager" {% if current_rank_filter == 'Manager' %}selected{% endif %}>Manager</option>
                    <option value="SuperAdmin" {% if current_rank_filter == 'SuperAdmin' %}selected{% endif %}>SuperAdmin</option>
                </select>
            </div>
            
        </form>
        
        <div class="modal-buttons" style="margin-top: 30px; justify-content: center;">
    <button type="button" class="save-btn" onclick="applyAllFilters()">–ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏</button>
    <button type="button" class="delete-btn" onclick="resetSortFilters()">–°–∫–∏–Ω—É—Ç–∏ –≤—Å—ñ —Ñ—ñ–ª—å—Ç—Ä–∏</button>
</div>

    </div>
</div>
    
            <div class="table-container">
                <div class="main-block">
                <div class="content-header">
                    <div>
                        <h2>{{ main_content_title }}</h2>
                        {% if main_content_title.startswith('–°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∏') %}
                            <p class="item-count-text">–ö—ñ–ª—å–∫—ñ—Å—Ç—å: **{{ item_count }}**</p>
                        {% endif %}
                    </div>
                    {% if main_content_title.startswith('–°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∏') %}
                        {% if user_rank in ['Manager', 'SuperAdmin'] %}
                            <button class="add-btn" onclick="openAddModal()">
                                ‚ûï –î–æ–¥–∞—Ç–∏ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞
                            </button>
                        {% endif %}
                    {% endif %}
                </div>
                
                <table class="data-table">
                    <thead>
                        <tr>
                            {% for header in col_headers %}
                            <th>{{ header }}</th>
                            {% endfor %}
                            {% if main_content_title.startswith('–°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∏') %}
                            <th>–î—ñ—ó</th>
                            {% endif %}
                            </tr>
                    </thead>
                    <tbody>
                        {% for row in table_data %}
                        <tr data-id="{{ row['helper_id'] }}" data-name="{{ row['admin_name'] }}" data-rank="{{ row['admin_rank'] }}" data-warnings="{{ row['warnings_count'] }}">
                            {% for key, value in row.items() %}
                                <td>{{ value }}</td>
                            {% endfor %}
                            
                            {% if main_content_title.startswith('–°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∏') %}
                            <td>
                                {% if user_rank == 'Curator' and row['admin_rank'] in ['Manager', 'SuperAdmin'] %}
                                    <button class="edit-btn" disabled title="–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –ø—Ä–∞–≤ –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫—ñ–≤ –≤–∏—â–µ –∑–∞ —Ä–∞–Ω–≥–æ–º">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
                                {% else %}
                                    <button class="edit-btn" onclick="openEditModal(this)">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
                                {% endif %}
                                </td>
                            {% endif %}
                            </tr>
                        {% else %}
                        <tr>
                            <td colspan="{{ col_headers|length + (1 if main_content_title.startswith('–°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∏') else 0) }}" style="text-align: center;">–°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∏ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
        </section>

    </main>

    <script src="{{ url_for('script', filename='helpinfo.js') }}"></script>

    <div id="addModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeAddModal()">&times;</span>
            <h2>–î–æ–¥–∞—Ç–∏ –Ω–æ–≤–æ–≥–æ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞</h2>
            
            <form method="POST" action="{{ url_for('add_helper') }}" id="addForm">
                
                <label for="add_admin_name">–Ü–º'—è:</label>
                <input type="text" id="add_admin_name" name="admin_name" required>
                
                <label for="add_admin_rank">–†–∞–Ω–≥:</label>
                <select id="add_admin_rank" name="admin_rank" required>
                    <option value="Moder">Moder</option>
                    <option value="Admin">Admin</option>
                    <option value="Curator">Curator</option>
                    {% if user_rank in ['Manager', 'SuperAdmin'] %}
                        <option value="Manager">Manager</option>
                    {% endif %}
                    {% if user_rank == 'SuperAdmin' %}
                        <option value="SuperAdmin">SuperAdmin</option>
                    {% endif %}
                </select>
                
                <label for="add_warnings_count">–ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è (–Ω–µ –æ–±–æ–≤'—è–∑–∫–æ–≤–æ, 0 –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º):</label>
                <input type="number" id="add_warnings_count" name="warnings_count" min="0" value="0">
                
                <div class="modal-buttons" style="justify-content: flex-end;">
                    <button type="submit" class="save-btn">–î–æ–¥–∞—Ç–∏</button>
                </div>
            </form>
        </div>
    </div>
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeEditModal()">&times;</span>
            <h2>–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞</h2>
            
            <form method="POST" action="{{ url_for('update_helper') }}" id="editForm">
                <input type="hidden" name="helper_id" id="modal_helper_id">
                
                <label for="modal_admin_name">–Ü–º'—è:</label>
                <input type="text" id="modal_admin_name" name="admin_name" required>
                
                <label for="modal_admin_rank">–†–∞–Ω–≥:</label>
                <select id="modal_admin_rank" name="admin_rank" required>
                    <option value="Moder">Moder</option>
                    <option value="Admin">Admin</option>
                    <option value="Curator">Curator</option>
                    {% if user_rank in ['Manager', 'SuperAdmin'] %}
                        <option value="Manager">Manager</option>
                    {% endif %}
                    {% if user_rank == 'SuperAdmin' %}
                        <option value="SuperAdmin">SuperAdmin</option>
                    {% endif %}
                </select>
                
                <label for="modal_warnings_count">–ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è:</label>
                <input type="number" id="modal_warnings_count" name="warnings_count" min="0" required>
                
                <div class="modal-buttons">
                    <div class="modal-buttons-left">
                        <button type="submit" class="save-btn">–ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏</button>
                    </div>
                    {% if user_rank in ['Manager', 'SuperAdmin'] %}
                    <div class="modal-buttons-delete-cancel">
                        <form method="POST" action="{{ url_for('delete_helper') }}" id="deleteForm" style="display:inline;">
                            <input type="hidden" name="helper_id" id="modal_delete_helper_id">
                            <button type="submit" class="delete-btn"
                             onclick="return confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞ ID ' + document.getElementById('modal_delete_helper_id').value + '?');">
                             –í–∏–¥–∞–ª–∏—Ç–∏
                            </button>
                        </form>
                    </div>
                    {% endif %}
                </div>
            </form>
        </div>
    </div>
</body>
</html>